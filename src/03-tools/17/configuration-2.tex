\documentclass{a4beamer}
\input{lecture-common.def}

\begingroup
	\catcode`\^=12
	\gdef\texthat{^}
\endgroup


\lecturetitle{Программная инженерия. Лекция №22 — Управление конфигурацией ПО (часть 2)}
\title[Конфигурация 2]{Управление конфигурацией ПО (часть 2)}
\author{Алексей Островский}
\institute{\small{Физико-технический учебно-научный центр НАН Украины}\vspace{2ex}}
\date{30 апреля 2015 г.}

\begin{document}
	\frame{\titlepage}

	\section{Построение}

	\frame{
		\frametitle{Построение системы}

		\begin{Definition}
			\textbf{Построение системы} \engterm{system building} — процесс создания полной исполняемой версии 
			программной системы путем компиляции и~связывания \engterm{linking} компонентов программы, 
			внешних библиотек, файлов конфигурации и~т.\,п.
		\end{Definition}

		\vspace{2.5ex}
		\begin{columns}[t]
			\begin{column}{0.45\textwidth}
				\textbf{Входные данные}

				\vspace{0.5ex}
				исходный код; \\
				файлы конфигурации; \\
				файлы данных (напр., локализация); \\
				внешние библиотеки; \\
				компиляторы и другие инструменты; \\
				тесты.
			\end{column}
			\begin{column}{0.45\textwidth}
				\textbf{Выходные данные}

				\vspace{0.5ex}
				исполняемые файлы; \\
				документация; \\
				результаты тестирования; \\
				упаковка исполняемых файлов (напр., JAR-архивы при~разработке в~Java); \\
				развертывание~ПО на~целевой системе.
			\end{column}
		\end{columns}
	}

	\subsection{Требования к инструментам построения}

	\frame{
		\frametitle{Инструменты построения}

		\textbf{Требования к инструментам построения:}
		\begin{itemize}
			\item
			Комплексное использование компиляторов (напр., \code{gcc}) и компоновщиков (напр., \code{ld}) 
			для~создания исполняемого кода, готового к~развертыванию.

			\vspace{0.5ex}
			\item
			Минимизация количества повторных действий: отслеживание изменившихся исходных файлов, 
			чтобы компилировать / компоновать только изменившиеся модули.

			\vspace{0.5ex}
			\item
			Использование промежуточных артефактов (напр., объектных файлов) 
			для~повышения модульности и~ускорения построения.

			\vspace{0.5ex}
			\item
			Отчеты об ошибках: остановка построения при~ошибке компиляции или~компоновки; 
			возможность быстро локализовать ошибку.
		\end{itemize}
	}

	\frame{
		\frametitle{Инструменты построения}

		\textbf{Требования к инструментам построения} (продолжение):
		\begin{itemize}
			\item
			Конфигурация построения: возможность задания параметров, 
			влияющих на~особенности построения системы (напр., дополнительные опции для~компиляторов / компоновщиков; 
			архитектура целевой системы).

			\vspace{0.5ex}
			\item
			Тестирование: автоматическая прогонка модульных / интеграционных тестов 
			после~компоновки для~определения корректности поведения системы.

			\vspace{0.5ex}
			\item
			Интеграция с системой управления версиями: запрос актуальных версий компонентов 
			из~хранилища перед~началом построения.

			\vspace{0.5ex}
			\item
			Дополнительные режимы построения для создания документации и~других вспомогательных ресурсов.
		\end{itemize}
	}

	\subsection{Классификация инструментов построения}

	\frame{
		\frametitle{Классификация инструментов построения}

		\begin{itemize}
			\item
			\textbf{Самостоятельные} — инструменты, вызываемые вручную (напр., из~командной строки).

			\vspace{1ex}
			\textbf{Достоинства:} большая гибкость; четкая спецификация действий при~построении.

			\vspace{0.5ex}
			\textbf{Недостатки:} большой объем конфигурационных файлов.

			\vspace{1.5ex}
			\item
			\textbf{Интегрированные} — утилиты, встроенные в интегрированные среды разработки (IDE).

			\vspace{0.5ex}
			{\small\textbf{NB.} Интегрированные инструменты построения часто основаны на~самостоятельных 
			(напр., построение в~Visual~Studio работает на~основе MSBuild).}

			\vspace{1ex}
			\textbf{Достоинства:} простота использования; минимальная потребность в~конфигурации.

			\vspace{0.5ex}
			\textbf{Недостатки:} недостаточная гибкость; потребность в~дополнительном~ПО для~построения системы.
		\end{itemize}
	}

	\frame{
		\frametitle{Классификация инструментов построения}

		\begin{center}
			\begin{tabular}{|p{0.2\textwidth}|p{0.25\textwidth}|p{0.4\textwidth}|}
			\hline
				\centering\textbf{Утилита} & \centering\textbf{Язык проекта} & \centering\textbf{Язык конфигурации} \cr
			\hline
				make & любой & Makefile \cr
			\hline
				Apache Ant & Java & XML \cr
			\hline
				NAnt & языки .NET & XML \cr
			\hline
				MSBuild & языки .NET, другие & XML \cr
			\hline
				Apache Maven & Java & \raggedright XML / модель проекта \engterm{Project Object Model} \cr
			\hline
				Gradle & Java, Groovy, другие & DSL на основе Groovy \cr
			\hline
			\end{tabular}
		\end{center}

		\vspace{1ex}
		\textbf{Примечание.} Большинство инструментов построения в разной степени поддерживают плагины, 
		расширяющие список допустимых действий.
	}

	\frame{
		\frametitle{Классификация инструментов построения}

		\begin{center}
			\input{fig-build-tools.tex}
		\end{center}

		\begin{itemize}
			\item
			\textbf{make} — отсутствие каких-либо априорных сведений о~структуре программной системы; 
			возможно построение произвольной системы с~использованием любых инструментов.

			\item
			\textbf{Apache Ant} — минимальные сведения о структуре программной системы (проект Java); 
			построение с~применением утилит разработки~Java (javac, jar, javadoc, …).

			\item
			\textbf{Apache Maven} — неявное соглашение о~структуре программной системы 
			(проект Java с~размещением исходного кода в~фиксированных директориях), 
			заданные наперед цели построения. 
			Конфигурационные файлы описывают \emph{отступления} от~соглашения.
		\end{itemize}
	}

	\subsection{Понятия построения}

	\frame{
		\frametitle{Цели построения}

		\begin{Definition}
			\textbf{Цель построения} \engterm{build target} — режим работы инструмента построения, 
			который специфицируется при~вызове инструмента (например, как~параметр командной строки) 
			и~означает проведение действий для~создания определенных промежуточных или~конечных программных артефактов.
		\end{Definition}

		\vspace{1ex}
		\textbf{Примеры целей построения:}
		\begin{itemize}
			\item
			компиляция всех исходных файлов;
			\item
			\emph{(зависит от предыдущего)} компоновка полученных объектных файлов в единый исполняемый файл;
			\item
			создание документации;
			\item
			удаление промежуточных артефактов построения (напр., объектных файлов).
		\end{itemize}
	}

	\frame{
		\frametitle{Зависимости}

		\begin{fact}
			Режим построения может зависеть от успешного выполнения другого режима построения.
		\end{fact}

		\vspace{1ex}
		\textbf{Пример:} компоновка объектных файлов зависит от компиляции исходного кода.

		\vspace{1ex}
		\textbf{Организация режимов построения:}
		\begin{itemize}
			\item
			Организация в виде ациклического ориентированного графа: 
			декларации зависимости (ребра) между режимами (вершины); режимы выполняются согласно 
			\extlink{http://en.wikipedia.org/wiki/Topological_sorting}{топологической сортировке}.

			\vspace{0.5ex}
			\textbf{Примеры утилит:} make, Apache Ant.

			\item
			Линейная организация (жизненный цикл): режимы построения выполняются в~фиксированном порядке.

			\vspace{0.5ex}
			\textbf{Примеры утилит:} Apache Maven.
		\end{itemize}
	}

	\subsection{Make}

	\frame{
		\frametitle{Make}

		\begin{Definition}
			\textbf{Make} — утилита для автоматического построения произвольных проектов из исходных файлов, 
			использующая сценарии построения (Makefile).
		\end{Definition}

		\vspace{1ex}
		\textbf{Поддерживаемые ОС:} *NIX; Windows (через Cygwin; nmake — аналог из MS Visual Studio).

		\vspace{1ex}
		\textbf{Достоинства:}
		\begin{itemize}
			\item
			построение произвольных программных проектов;
			\item
			отсутствие необходимости в плагинах для задействования внешних инструментов;
			\item
			возможность динамического добавления правил во время построения.
		\end{itemize}

		\vspace{0.5ex}
		\textbf{Недостатки:}
		\begin{itemize}
			\item
			большой объем файлов конфигурации, затраты на их создание и поддержку 
			(решается использованием генераторов);
			\item
			проблемы переносимости между ОС.
		\end{itemize}
	}

	\frame{
		\frametitle{Составляющие Makefile}

		\begin{itemize}
			\item
			\textbf{Макросы} — $\sim$~переменные в языках программирования, подставляются в~правила и~действия; 
			позволяют конфигурировать построение (напр., используемые компиляторы).

			\vspace{0.5ex}
			\textbf{Синтаксис:}
			\lstinputlisting[language=make,escapechar=!]{code-mk-syntax-1}

			\vspace{1ex}
			\item
			\textbf{Включения} других конфигурационных файлов Makefile.

			\vspace{0.5ex}
			\textbf{Синтаксис:}
			\lstinputlisting[language=make,escapechar=!,morekeywords={include}]{code-mk-syntax-2}
		\end{itemize}
	}

	\frame{
		\frametitle{Составляющие Makefile}

		\begin{itemize}
			\item
			\textbf{Правила} — \emph{зависимости} (другие режимы построения и~файлы), 
			которые влияют на~\emph{цель} (режим построения или~выходной файл / файлы).

			\vspace{1ex}
			\item
			\textbf{Действия} — произвольные команды, выполняемые в~оболочке \code{sh} для~создания выходных файлов.

			\vspace{0.5ex}
			\textbf{Синтаксис:}
			\lstinputlisting[language=make,escapechar=!]{code-mk-syntax-3}
		\end{itemize}
	}

	\frame{
		\frametitle{Пример Makefile для построения программы на C}

		\lstinputlisting[language=make,escapechar=!]{code-mk-c}
	}

	\frame{
		\frametitle{Дополнительные возможности make}

		\begin{itemize}
			\item
			\textbf{Правила на основе суффиксов} \engterm{suffix rules} — шаблон правил для~построения 
			определенного типа файлов (напр., объектных файлов \code{*.o} на~основе исходных файлов \code{*.c}).

			\vspace{0.5ex}
			\item
			\textbf{Шаблонные правила} \engterm{pattern rules} — обобщение правил на~основе суффиксов
			с~шаблонным видом выходных файлов.

			\vspace{0.5ex}
			\item
			Использование \textbf{подстановочных знаков} (* и ?) в~списках зависимостей.

			\vspace{0.5ex}
			\item
			\textbf{Функции} для преобразования макросов.

			\vspace{0.5ex}
			\item
			\textbf{Директивы ветвления} для условного выполнения команд или~объявления макросов.

			\vspace{0.5ex}
			\item
			\textbf{Интерпретация кода}, напр., для~динамического добавления правил.
		\end{itemize}
	}

	\frame{
		\frametitle{Построение с помощью make}

		\begin{center}
			\code{\only<3>{autoconf \&\& }\only<2->{./configure \&\& }make \&\& [sudo] make install}
		\end{center}

		\begin{itemize}
			\only<3>{%
				\item
				\textbf{autoconf:} Создает сценарий конфигурации configure на~основе списка проверок и~т.\,п.; 
				генерирует сценарии Makefile с~помощью шаблонов.
			}
			\only<2->{%
				\item
				\textbf{configure:} пределяет конфигурацию построения и~создает файлы, включаемые в~основной Makefile.
			}
			\item
			\textbf{make:} компилирует и компонует составляющие приложения;
			\item
			\textbf{make install:} устанавливает полученные выполняемые файлы / библиотеки в~конечный пункт назначения.
		\end{itemize}

		\only<1>{%
			\vspace{1ex}
			\textbf{Проблема:} Определение конфигурации построения (используемых компиляторов, архитектуры целевой системы, …) 
			средствами make невозможно или~чрезвычайно сложно.
		}
		\only<2>{%
			\textbf{Проблема:} Создание сценария конфигурации вручную занимает много усилий.
		}
	}

	\subsection{Ant}

	\frame{
		\frametitle{Apache Ant}

		\begin{Definition}
			\textbf{Apache Ant} — утилита для автоматического построения проектов, 
			написанных на~языке программирования Java.
		\end{Definition}

		\vspace{1ex}
		\textbf{Поддерживаемые ОС:} произвольные (требуется Java Runtime).

		\vspace{1ex}
		\textbf{Достоинства:}
		\begin{itemize}
			\item портируемость (базовые задания не зависят от операционной системы);
			\item широкие возможности по фильтрации файлов для передачи в команды;
			\item интеграция с системой тестирования JUnit.
		\end{itemize}

		\vspace{0.5ex}
		\textbf{Недостатки:} \\
		ограниченность встроенных команд (для расширения требуются внешние плагины).
	}

	\frame{
		\frametitle{Формат файлов конфигурации Ant}

		\begin{itemize}
			\item
			\textbf{Переменные} (могут подставляться в аргументы команд).

			\vspace{0.5ex}
			\textbf{Синтаксис:} \code{<property name="имя" value="значение" />}

			\vspace{1ex}
			\item
			\textbf{Цели построения.}

			\vspace{0.5ex}
			\textbf{Синтаксис:} \\
			\code{%
				<target name="имя" description="описание" \\
				\hspace{4em} depends="зависимости (цели построения)"> \\
				\hspace{2em} команды \\
				</target>}

			\vspace{1ex}
			\item
			\textbf{Команды.}

			\vspace{0.5ex}
			\textbf{Синтаксис:} XML-тег с атрибутами и / или внутренними элементами, зависящими от~типа~команды.
		\end{itemize}
	}

	\frame{
		\frametitle{Пример файла конфигурации Ant}

		\lstinputlisting[language=Ant,escapechar=\#,firstline=2]{code-build.xml}
	}

	\section[CI]{Непрерывная интеграция}

	\frame{
		\frametitle{Непрерывная интеграция}

		\begin{Definition}
			\textbf{Непрерывная интеграция} \engterm{continuous integration, CI} — метод разработки~ПО, 
			основанный на~частой (несколько раз в~день) фиксации всех~изменений, вносимых в~систему разработчиками.
		\end{Definition}

		\vspace{1ex}
		\textbf{Автор:} Гради Буч (Grady Booch).

		\vspace{1ex}
		\textbf{Связанные технологии:}
		\begin{itemize}
			\item экстремальное программирование \engterm{extreme programming, XP}; 
			\item разработка через тестирование \engterm{test-driven development, TDD}.
		\end{itemize}

		\vspace{1ex}
		\textbf{Цели:}
		\begin{itemize}
			\item
			предотвращение проблем интеграции между компонентами программной системы;
			\item
			проверка изменений с помощью систем автоматического тестирования.
		\end{itemize}
	}

	\subsection{Принципы}

	\frame{
		\frametitle{Принципы непрерывной интеграции}

		\begin{itemize}
			\item
			\textbf{Система управления версиями}, охватывающая все артефакты, необходимые для~построения проекта;

			\vspace{0.5ex}
			\item
			\textbf{инструменты построения} для автоматического создания промежуточных выпусков;

			\vspace{0.5ex}
			\item
			\textbf{автоматическое тестирование} системы при построении;

			\vspace{0.5ex}
			\item
			\textbf{регулярное фиксирование изменений} (не реже раза в день) с~построением проекта 
			после~фиксирования;

			\vspace{0.5ex}
			\item
			\textbf{выделенный сервер} для построения / тестирования (копия целевой системы);

			\vspace{0.5ex}
			\item
			\textbf{прозрачность и доступность результатов построения} для~разработчиков и~заказчиков.
		\end{itemize}
	}

	\frame{
		\frametitle{Разработка согласно CI}

		\begin{figure}
			\input{fig-ci.tex}
			\caption{При разработке согласно CI после внесения изменений в~программную систему 
				и~успешного построения на~компьютере разработчика приложение строится на~тестовом сервере.}
		\end{figure}
	}

	\frame{
		\frametitle{Преимущества и недостатки CI}

		\textbf{Преимущества:}
		\begin{itemize}
			\item
			быстрая локализация дефектов интеграции;
			\item
			более равномерное распределение внесения изменений в систему;
			\item
			постоянная доступность актуальной рабочей версии программной системы для~тестирования, 
			демонстрирования или~выпуска;
			\item
			возможность быстрого отката дефектного кода без~существенной потери функциональности.
		\end{itemize}

		\vspace{1ex}
		\textbf{Недостатки:}
		\begin{itemize}
			\item
			необходимость устройства выделенного сервера тестирования с~параметрами, 
			сходными с~целевой системой;
			\item
			для больших систем построение может занимать много времени.
		\end{itemize}
	}

	\section{Выпуски}

	\frame{
		\frametitle{Выпуски ПО}

		\begin{Definition}
			\textbf{Выпуск ПО} \engterm{software release} — версия программной системы, 
			предназначенная для~использования вне~отдела разработки.
		\end{Definition}

		\vspace{1ex}
		\textbf{Аспекты управления выпусками:}
		\begin{itemize}
			\item
			идентифицируемость — определение версий исходных файлов, инструментов, среды, задействованных в~построении системы;
			\item
			повторяемость — возможность повторного построения системы ($\Rightarrow$ сохранение версий исходных файлов и~т.\,п.);
			\item
			согласованность — автоматизация создания выпусков и~их~составляющих (напр., программ установки~ПО).
		\end{itemize}
	}

	\subsection{Составляющие}

	\frame{
		\frametitle{Состав выпуска}

		\textbf{Обязательные элементы:}
		\begin{itemize}
			\item
			выполняемый код (двоичные выполняемые файлы, библиотеки, сценарии, …)
		\end{itemize}
		или
		\begin{itemize}
			\item
			исходные файлы для построения программы в~среде пользователя.
		\end{itemize}

		\vspace{1ex}
		\textbf{Необязательные элементы:}
		\begin{itemize}
			\item
			программа установки;
			\item
			файлы конфигурации;
			\item
			файлы данных (напр., локализация сообщений, используемых в программе);
			\item
			электронная и печатная документация.
		\end{itemize}
	}

	\frame{
		\frametitle{Жизненный цикл выпусков ПО}

		\textbf{Технические (внутренние) выпуски:}
		\begin{itemize}
			\item
			рабочий выпуск \engterm{development release, pre-alpha, nightly build} — для~использования разработчиками: 
			создания архитектуры, проектирования и~кодирования компонентов системы и~т.\,п.;
			\item
			альфа-выпуск \engterm{alpha release} — для тестирования по~методу белого ящика;
			\item
			бета-выпуск \engterm{beta release} — для тестирования по~методу черного ящика;
			\item
			кандидат \engterm{release candidate, RC} — бета-выпуск, в котором устранено большинство дефектов, 
			потенциально готовый для публичного использования.
		\end{itemize}

		\vspace{1ex}
		\textbf{Публичные выпуски:}
		\begin{itemize}
			\item
			RTM (release to manufacturing) — выпуск, предназначенный для распространения и~развертывания 
			на~системах потребителей.
		\end{itemize}
	}

	\subsection{Планирование}

	\frame{
		\frametitle{Планирование выпусков}

		\textbf{Факторы, влияющие на расписание выпусков:}
		\begin{itemize}
			\item
			обнаруженные дефекты, требующие исправление в~виде отдельного выпуска или~патча;
			\item
			изменение среды выполнения (напр., новая версия операционной системы 
			или~используемых внешних библиотек);
			\item
			законы эволюции ПО:
			\begin{itemize}
				\item необходимость добавления новой функциональности (в~т.\,ч. для~успешной конкуренции);
				\item исправление ошибок, связанных с новыми функциями;
			\end{itemize}
			\item
			расписание, составленное отделом маркетинга;
			\item
			требования заказчика.
		\end{itemize}
	}

	\subsection{Нумерация версий}

	\frame{
		\frametitle{Нумерация версий ПО}

		\textbf{Цели:}
		\begin{itemize}
			\item
			идентификация выпусков;
			\item
			определение совместимости API различных выпусков;
			\item
			определение совместимости между программами и зависимостей в репозиториях приложений;
			\item
			маркетинг.
		\end{itemize}

		\vspace{1ex}
		\textbf{Схемы нумерации:}
		\begin{itemize}
			\item
			целые числа (1, 2, 3, …);
			\item
			десятичные дроби (1.0, 1.01, 1.1, 1.2, …);
			\item
			последовательность чисел (1.0.0, 1.0.1, 1.0.2, 1.1.0, …);
			\item
			даты;
			\item
			произвольные строки.
		\end{itemize}
	}

	\frame{
		\frametitle{Семантическая нумерация}

		\textbf{Формат версии:} \quad\code{major.minor[.patch[-suffix]]}

		\vspace{1ex}
		\begin{itemize}
			\item
			\textbf{major} — главная версия, целое неотрицательное число, увеличивающееся при~внесении значительных изменений 
			(напр., несовместимых модификаций API);

			\vspace{0.5ex}
			\textbf{major = 0} означает бета-выпуск;

			\vspace{1ex}
			\item
			\textbf{minor} — второстепенная версия, целое неотрицательное число, 
			увеличивающееся при~внесении обратно совместимых изменений;

			\vspace{1ex}
			\item
			\textbf{patch} — версия построения, целое неотрицательное число, увеличивающееся при~каждом построении системы 
			(напр., при~исправлении ошибок). По~умолчанию равна~нулю.

			\vspace{1ex}
			\item
			\textbf{suffix} — алфавитно-цифровая последовательность для~обозначения внутренних выпусков, напр., \code{alpha}, \code{rc.1}.
		\end{itemize}
	}

	\frame{
		\frametitle{Пример нумерации версий ПО}

		\begin{figure}
			\input{fig-versions.tex}
			\caption{%
				\textbf{Примечание.} Технические выпуски создаются для~каждого или~почти~каждого 
				публичного выпуска~ПО; они~не~показаны на~схеме из-за~нехватки места.}
		\end{figure}
	}

	\section{Заключение}

	\subsection{Выводы}
	
	\frame{
		\frametitle{Выводы}

		\begin{enumerate}
			\item
			Управление версиями ПО связанно с~двумя другими аспектами управления конфигурацией — 
			построением программной системы и~управлением выпусками.

			\vspace{0.5ex}
			\item
			Инструменты автоматического построения~ПО различаются областью применения. 
			Наиболее универсальная утилита построения — make — может выполнять построение произвольных проектов. 
			Для~Java-проектов одним из~популярных средств построения является Apache Ant.

			\vspace{0.5ex}
			\item
			Автоматическое построение и управление версиями используются в~непрерывной интеграции (\emph{continuous integration}) 
			для~устранения ошибок интеграции при~коллективной разработке.

			\vspace{0.5ex}
			\item
			Выпуски ПО — это версии программной системы, предназначенные для~тестирования (технические выпуски) 
			или~использования потребителями (публичные выпуски). 
			Для~идентификации выпусков используются различные способы нумерации версий, 
			напр., семантическая нумерация (\emph{semantic versioning}).
		\end{enumerate}
	}
	
	\subsection{Материалы}
	
	\frame{
		\frametitle{Материалы}
		
		\begin{thebibliography}{9}
			\bibitem[1]{1}
			Sommerville, Ian
			\newblock Software Engineering.
			\newblock {\footnotesize Pearson, 2011. — 790 p.}

			\bibitem[2]{2}
			GNU
			\newblock GNU Make Manual.
			\newblock {\footnotesize\url{https://www.gnu.org/software/make/manual/make.html}}

			\bibitem[3]{3}
			Fowler, Martin
			\newblock Continuous Integration.
			\newblock {\footnotesize\url{http://martinfowler.com/articles/continuousIntegration.html}}

			\bibitem[4]{4}
			Preston-Werner, Tom
			\newblock Semantic versioning.
			\newblock {\footnotesize\url{http://semver.org/}}
		\end{thebibliography}
	}
	
	\frame{
		\frametitle{}
		
		\begin{center}
			\Huge Спасибо за внимание!
		\end{center}
	}

\end{document}

